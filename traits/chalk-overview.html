<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>An Overview of Chalk - Guide to Rustc Development</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to developing rustc">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../about-this-guide.html">关于</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../part-1-intro.html"><strong aria-hidden="true">1.</strong> Part 1: 构建，调试和向rustc贡献代码</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../compiler-team.html"><strong aria-hidden="true">1.1.</strong> About the compiler team</a></li><li class="chapter-item "><a href="../building/how-to-build-and-run.html"><strong aria-hidden="true">1.2.</strong> 如何构建并运行编译器</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../building/suggested.html"><strong aria-hidden="true">1.2.1.</strong> 推荐的工作流程</a></li><li class="chapter-item "><a href="../building/bootstrapping.html"><strong aria-hidden="true">1.2.2.</strong> 编译器自举</a></li><li class="chapter-item "><a href="../building/build-install-distribution-artifacts.html"><strong aria-hidden="true">1.2.3.</strong> Distribution artifacts</a></li><li class="chapter-item "><a href="../building/compiler-documenting.html"><strong aria-hidden="true">1.2.4.</strong> Documenting Compiler</a></li><li class="chapter-item "><a href="../building/ctags.html"><strong aria-hidden="true">1.2.5.</strong> ctags</a></li></ol></li><li class="chapter-item "><a href="../tests/intro.html"><strong aria-hidden="true">1.3.</strong> The compiler testing framework</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/running.html"><strong aria-hidden="true">1.3.1.</strong> Running tests</a></li><li class="chapter-item "><a href="../tests/adding.html"><strong aria-hidden="true">1.3.2.</strong> Adding new tests</a></li><li class="chapter-item "><a href="../compiletest.html"><strong aria-hidden="true">1.3.3.</strong> Using compiletest + commands to control test execution</a></li></ol></li><li class="chapter-item "><a href="../walkthrough.html"><strong aria-hidden="true">1.4.</strong> Walkthrough: a typical contribution</a></li><li class="chapter-item "><a href="../bug-fix-procedure.html"><strong aria-hidden="true">1.5.</strong> Bug Fix Procedure</a></li><li class="chapter-item "><a href="../implementing_new_features.html"><strong aria-hidden="true">1.6.</strong> Implementing new features</a></li><li class="chapter-item "><a href="../stability.html"><strong aria-hidden="true">1.7.</strong> Stability attributes</a></li><li class="chapter-item "><a href="../stabilization_guide.html"><strong aria-hidden="true">1.8.</strong> Stabilizing Features</a></li><li class="chapter-item "><a href="../compiler-debugging.html"><strong aria-hidden="true">1.9.</strong> Debugging the Compiler</a></li><li class="chapter-item "><a href="../profiling.html"><strong aria-hidden="true">1.10.</strong> Profiling the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../profiling/with_perf.html"><strong aria-hidden="true">1.10.1.</strong> with the linux perf tool</a></li></ol></li><li class="chapter-item "><a href="../conventions.html"><strong aria-hidden="true">1.11.</strong> Coding conventions</a></li><li class="chapter-item "><a href="../crates-io.html"><strong aria-hidden="true">1.12.</strong> crates.io Dependencies</a></li><li class="chapter-item "><a href="../diagnostics.html"><strong aria-hidden="true">1.13.</strong> Emitting Errors and other Diagnostics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../diagnostics/lintstore.html"><strong aria-hidden="true">1.13.1.</strong> LintStore</a></li><li class="chapter-item "><a href="../diagnostics/diagnostic-codes.html"><strong aria-hidden="true">1.13.2.</strong> Diagnostic Codes</a></li></ol></li><li class="chapter-item "><a href="../ice-breaker/about.html"><strong aria-hidden="true">1.14.</strong> ICE-breaker teams</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ice-breaker/cleanup-crew.html"><strong aria-hidden="true">1.14.1.</strong> &quot;Cleanup Crew&quot; ICE-breakers</a></li><li class="chapter-item "><a href="../ice-breaker/llvm.html"><strong aria-hidden="true">1.14.2.</strong> LLVM ICE-breakers</a></li></ol></li><li class="chapter-item "><a href="../licenses.html"><strong aria-hidden="true">1.15.</strong> Licenses</a></li></ol></li><li class="chapter-item expanded "><a href="../part-2-intro.html"><strong aria-hidden="true">2.</strong> Part 2: 高层编译器架构</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../overview.html"><strong aria-hidden="true">2.1.</strong> Overview of the Compiler</a></li><li class="chapter-item "><a href="../compiler-src.html"><strong aria-hidden="true">2.2.</strong> 编译器源码结构</a></li><li class="chapter-item "><a href="../query.html"><strong aria-hidden="true">2.3.</strong> 查询：需求驱动的编译</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../queries/query-evaluation-model-in-detail.html"><strong aria-hidden="true">2.3.1.</strong> 查询求值模型的详细介绍</a></li><li class="chapter-item "><a href="../queries/incremental-compilation.html"><strong aria-hidden="true">2.3.2.</strong> Incremental compilation</a></li><li class="chapter-item "><a href="../queries/incremental-compilation-in-detail.html"><strong aria-hidden="true">2.3.3.</strong> Incremental compilation In Detail</a></li><li class="chapter-item "><a href="../incrcomp-debugging.html"><strong aria-hidden="true">2.3.4.</strong> Debugging and Testing</a></li><li class="chapter-item "><a href="../queries/profiling.html"><strong aria-hidden="true">2.3.5.</strong> Profiling Queries</a></li><li class="chapter-item "><a href="../salsa.html"><strong aria-hidden="true">2.3.6.</strong> Salsa</a></li></ol></li><li class="chapter-item "><a href="../memory.html"><strong aria-hidden="true">2.4.</strong> Memory Management in Rustc</a></li></ol></li><li class="chapter-item expanded "><a href="../part-3-intro.html"><strong aria-hidden="true">3.</strong> Part 3: 源代码的不同表示</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rustc-driver.html"><strong aria-hidden="true">3.1.</strong> The Rustc Driver and Interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rustdoc.html"><strong aria-hidden="true">3.1.1.</strong> Rustdoc</a></li><li class="chapter-item "><a href="../rustc-driver-interacting-with-the-ast.html"><strong aria-hidden="true">3.1.2.</strong> Ex: Type checking through rustc_interface</a></li></ol></li><li class="chapter-item "><a href="../syntax-intro.html"><strong aria-hidden="true">3.2.</strong> 符号与AST</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../the-parser.html"><strong aria-hidden="true">3.2.1.</strong> 词法分析与文法分析</a></li><li class="chapter-item "><a href="../test-implementation.html"><strong aria-hidden="true">3.2.2.</strong> #[test] Implementation</a></li><li class="chapter-item "><a href="../panic-implementation.html"><strong aria-hidden="true">3.2.3.</strong> Panic Implementation</a></li><li class="chapter-item "><a href="../macro-expansion.html"><strong aria-hidden="true">3.2.4.</strong> Macro expansion</a></li><li class="chapter-item "><a href="../name-resolution.html"><strong aria-hidden="true">3.2.5.</strong> Name resolution</a></li><li class="chapter-item "><a href="../ast-validation.html"><strong aria-hidden="true">3.2.6.</strong> AST Validation</a></li><li class="chapter-item "><a href="../feature-gate-ck.html"><strong aria-hidden="true">3.2.7.</strong> Feature Gate Checking</a></li></ol></li><li class="chapter-item "><a href="../hir.html"><strong aria-hidden="true">3.3.</strong> HIR （高层IR）</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../lowering.html"><strong aria-hidden="true">3.3.1.</strong> 将AST lower 到 HIR</a></li><li class="chapter-item "><a href="../hir-debugging.html"><strong aria-hidden="true">3.3.2.</strong> Debugging</a></li></ol></li><li class="chapter-item "><a href="../mir/index.html"><strong aria-hidden="true">3.4.</strong> MIR （中层IR）</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../mir/construction.html"><strong aria-hidden="true">3.4.1.</strong> HAIR 与 MIR 的构造</a></li><li class="chapter-item "><a href="../mir/visitor.html"><strong aria-hidden="true">3.4.2.</strong> MIR 访问者与遍历</a></li><li class="chapter-item "><a href="../mir/passes.html"><strong aria-hidden="true">3.4.3.</strong> MIR passes: 为一个函数获取MIR</a></li></ol></li><li class="chapter-item "><a href="../closure.html"><strong aria-hidden="true">3.5.</strong> Closure expansion</a></li></ol></li><li class="chapter-item expanded "><a href="../part-4-intro.html"><strong aria-hidden="true">4.</strong> Part 4: 分析</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ty.html"><strong aria-hidden="true">4.1.</strong> ty 模块：类型的表示</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../generics.html"><strong aria-hidden="true">4.1.1.</strong> 范型和替换</a></li><li class="chapter-item "><a href="../ty-fold.html"><strong aria-hidden="true">4.1.2.</strong> TypeFolder and TypeFoldable</a></li><li class="chapter-item "><a href="../generic_arguments.html"><strong aria-hidden="true">4.1.3.</strong> Generic arguments</a></li></ol></li><li class="chapter-item "><a href="../type-inference.html"><strong aria-hidden="true">4.2.</strong> Type inference</a></li><li class="chapter-item "><a href="../traits/resolution.html"><strong aria-hidden="true">4.3.</strong> Trait solving (old-style)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/hrtb.html"><strong aria-hidden="true">4.3.1.</strong> Higher-ranked trait bounds</a></li><li class="chapter-item "><a href="../traits/caching.html"><strong aria-hidden="true">4.3.2.</strong> Caching subtleties</a></li><li class="chapter-item "><a href="../traits/specialization.html"><strong aria-hidden="true">4.3.3.</strong> Specialization</a></li></ol></li><li class="chapter-item expanded "><a href="../traits/index.html"><strong aria-hidden="true">4.4.</strong> Trait solving (new-style)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/lowering-to-logic.html"><strong aria-hidden="true">4.4.1.</strong> Lowering to logic</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/goals-and-clauses.html"><strong aria-hidden="true">4.4.1.1.</strong> Goals and clauses</a></li><li class="chapter-item "><a href="../traits/associated-types.html"><strong aria-hidden="true">4.4.1.2.</strong> Equality and associated types</a></li><li class="chapter-item "><a href="../traits/implied-bounds.html"><strong aria-hidden="true">4.4.1.3.</strong> Implied bounds</a></li><li class="chapter-item "><a href="../traits/regions.html"><strong aria-hidden="true">4.4.1.4.</strong> Region constraints</a></li><li class="chapter-item "><a href="../traits/lowering-module.html"><strong aria-hidden="true">4.4.1.5.</strong> The lowering module in rustc</a></li><li class="chapter-item "><a href="../traits/lowering-rules.html"><strong aria-hidden="true">4.4.1.6.</strong> Lowering rules</a></li><li class="chapter-item "><a href="../traits/wf.html"><strong aria-hidden="true">4.4.1.7.</strong> Well-formedness checking</a></li></ol></li><li class="chapter-item "><a href="../traits/canonical-queries.html"><strong aria-hidden="true">4.4.2.</strong> Canonical queries</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../traits/canonicalization.html"><strong aria-hidden="true">4.4.2.1.</strong> Canonicalization</a></li></ol></li><li class="chapter-item "><a href="../traits/slg.html"><strong aria-hidden="true">4.4.3.</strong> The SLG solver</a></li><li class="chapter-item expanded "><a href="../traits/chalk-overview.html" class="active"><strong aria-hidden="true">4.4.4.</strong> An Overview of Chalk</a></li><li class="chapter-item "><a href="../traits/bibliography.html"><strong aria-hidden="true">4.4.5.</strong> Bibliography</a></li></ol></li><li class="chapter-item "><a href="../type-checking.html"><strong aria-hidden="true">4.5.</strong> Type checking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../method-lookup.html"><strong aria-hidden="true">4.5.1.</strong> Method Lookup</a></li><li class="chapter-item "><a href="../variance.html"><strong aria-hidden="true">4.5.2.</strong> Variance</a></li><li class="chapter-item "><a href="../opaque-types-type-alias-impl-trait.html"><strong aria-hidden="true">4.5.3.</strong> Opaque Types</a></li></ol></li><li class="chapter-item "><a href="../pat-exhaustive-checking.html"><strong aria-hidden="true">4.6.</strong> Pattern and Exhaustiveness Checking</a></li><li class="chapter-item "><a href="../borrow_check.html"><strong aria-hidden="true">4.7.</strong> The borrow checker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/moves_and_initialization.html"><strong aria-hidden="true">4.7.1.</strong> Tracking moves and initialization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/moves_and_initialization/move_paths.html"><strong aria-hidden="true">4.7.1.1.</strong> Move paths</a></li></ol></li><li class="chapter-item "><a href="../borrow_check/type_check.html"><strong aria-hidden="true">4.7.2.</strong> MIR type checker</a></li><li class="chapter-item "><a href="../borrow_check/region_inference.html"><strong aria-hidden="true">4.7.3.</strong> Region inference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../borrow_check/region_inference/constraint_propagation.html"><strong aria-hidden="true">4.7.3.1.</strong> Constraint propagation</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/lifetime_parameters.html"><strong aria-hidden="true">4.7.3.2.</strong> Lifetime parameters</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/member_constraints.html"><strong aria-hidden="true">4.7.3.3.</strong> Member constraints</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/placeholders_and_universes.html"><strong aria-hidden="true">4.7.3.4.</strong> Placeholders and universes</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/closure_constraints.html"><strong aria-hidden="true">4.7.3.5.</strong> Closure constraints</a></li><li class="chapter-item "><a href="../borrow_check/region_inference/error_reporting.html"><strong aria-hidden="true">4.7.3.6.</strong> Error reporting</a></li></ol></li><li class="chapter-item "><a href="../borrow_check/two_phase_borrows.html"><strong aria-hidden="true">4.7.4.</strong> Two-phase-borrows</a></li></ol></li><li class="chapter-item "><a href="../param_env.html"><strong aria-hidden="true">4.8.</strong> Parameter Environments</a></li></ol></li><li class="chapter-item expanded "><a href="../part-5-intro.html"><strong aria-hidden="true">5.</strong> Part 5: From MIR to binaries</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../mir/index.html"><strong aria-hidden="true">5.1.</strong> The MIR (Mid-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../mir/optimizations.html"><strong aria-hidden="true">5.1.1.</strong> MIR optimizations</a></li><li class="chapter-item "><a href="../mir/debugging.html"><strong aria-hidden="true">5.1.2.</strong> Debugging</a></li></ol></li><li class="chapter-item "><a href="../const-eval.html"><strong aria-hidden="true">5.2.</strong> Constant evaluation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../miri.html"><strong aria-hidden="true">5.2.1.</strong> miri const evaluator</a></li></ol></li><li class="chapter-item "><a href="../backend/monomorph.html"><strong aria-hidden="true">5.3.</strong> Monomorphization</a></li><li class="chapter-item "><a href="../backend/lowering-mir.html"><strong aria-hidden="true">5.4.</strong> Lowering MIR</a></li><li class="chapter-item "><a href="../backend/codegen.html"><strong aria-hidden="true">5.5.</strong> Code Generation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../backend/updating-llvm.html"><strong aria-hidden="true">5.5.1.</strong> Updating LLVM</a></li><li class="chapter-item "><a href="../backend/debugging.html"><strong aria-hidden="true">5.5.2.</strong> Debugging LLVM</a></li><li class="chapter-item "><a href="../backend/backend-agnostic.html"><strong aria-hidden="true">5.5.3.</strong> Backend Agnostic Codegen</a></li><li class="chapter-item "><a href="../codegen/implicit-caller-location.html"><strong aria-hidden="true">5.5.4.</strong> Implicit Caller Location</a></li></ol></li><li class="chapter-item "><a href="../profile-guided-optimization.html"><strong aria-hidden="true">5.6.</strong> Profile-guided Optimization</a></li><li class="chapter-item "><a href="../sanitizers.html"><strong aria-hidden="true">5.7.</strong> Sanitizers Support</a></li><li class="chapter-item "><a href="../debugging-support-in-rustc.html"><strong aria-hidden="true">5.8.</strong> Debugging Support in Rust Compiler</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../appendix/background.html">Appendix A: Background material</a></li><li class="chapter-item expanded affix "><a href="../appendix/glossary.html">Appendix B: Glossary</a></li><li class="chapter-item expanded affix "><a href="../appendix/code-index.html">Appendix C: Code Index</a></li><li class="chapter-item expanded affix "><a href="../appendix/compiler-lecture.html">Appendix D: Compiler Lecture Series</a></li><li class="chapter-item expanded affix "><a href="../appendix/bibliography.html">Appendix E: Bibliography</a></li><li class="chapter-item expanded affix "><a href="../appendix/humorust.html">Appendix Z: HumorRust</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Guide to Rustc Development</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/longfangsong/rustc-dev-guide-cn" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#an-overview-of-chalk" id="an-overview-of-chalk">An Overview of Chalk</a></h1>
<blockquote>
<p>Chalk is under heavy development, so if any of these links are broken or if
any of the information is inconsistent with the code or outdated, please
<a href="https://github.com/rust-lang/rustc-dev-guide/issues">open an issue</a> so we can fix it. If you are able to fix the
issue yourself, we would love your contribution!</p>
</blockquote>
<p><a href="https://github.com/rust-lang/chalk">Chalk</a> recasts Rust's trait system explicitly in terms of logic
programming by &quot;lowering&quot; Rust code into a kind of logic program we can then
execute queries against (see <a href="./lowering-to-logic.html"><em>Lowering to Logic</em></a> and
<a href="./lowering-rules.html"><em>Lowering Rules</em></a>). Its goal is to be an executable, highly
readable specification of the Rust trait system.</p>
<p>There are many expected benefits from this work. It will consolidate our
existing, somewhat ad-hoc implementation into something far more principled and
expressive, which should behave better in corner cases, and be much easier to
extend.</p>
<h2><a class="header" href="#chalk-structure" id="chalk-structure">Chalk Structure</a></h2>
<p>Chalk has two main &quot;products&quot;. The first of these is the
<a href="https://rust-lang.github.io/chalk/chalk_engine"><code>chalk_engine</code></a> crate, which defines the core <a href="./slg.html">SLG
solver</a>. This is the part rustc uses.</p>
<p>The rest of chalk can be considered an elaborate testing harness. Chalk is
capable of parsing Rust-like &quot;programs&quot;, lowering them to logic, and
performing queries on them.</p>
<p>Here's a sample session in the chalk repl, chalki. After feeding it our
program, we perform some queries on it.</p>
<pre><code class="language-rust ignore">?- program
Enter a program; press Ctrl-D when finished
| struct Foo { }
| struct Bar { }
| struct Vec&lt;T&gt; { }
| trait Clone { }
| impl&lt;T&gt; Clone for Vec&lt;T&gt; where T: Clone { }
| impl Clone for Foo { }

?- Vec&lt;Foo&gt;: Clone
Unique; substitution [], lifetime constraints []

?- Vec&lt;Bar&gt;: Clone
No possible solution.

?- exists&lt;T&gt; { Vec&lt;T&gt;: Clone }
Ambiguous; no inference guidance
</code></pre>
<p>You can see more examples of programs and queries in the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L115">unit
tests</a>.</p>
<p>Next we'll go through each stage required to produce the output above.</p>
<h3><a class="header" href="#parsing-a-hrefhttpsrust-langgithubiochalkchalk_parseindexhtmlchalk_parsea" id="parsing-a-hrefhttpsrust-langgithubiochalkchalk_parseindexhtmlchalk_parsea">Parsing (<a href="https://rust-lang.github.io/chalk/chalk_parse/index.html">chalk_parse</a>)</a></h3>
<p>Chalk is designed to be incorporated with the Rust compiler, so the syntax and
concepts it deals with heavily borrow from Rust. It is convenient for the sake
of testing to be able to run chalk on its own, so chalk includes a parser for a
Rust-like syntax. This syntax is orthogonal to the Rust AST and grammar. It is
not intended to look exactly like it or support the exact same syntax.</p>
<p>The parser takes that syntax and produces an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree (AST)</a>.
You can find the <a href="https://rust-lang.github.io/chalk/chalk_parse/ast/index.html">complete definition of the AST</a> in the source code.</p>
<p>The syntax contains things from Rust that we know and love, for example: traits,
impls, and struct definitions. Parsing is often the first &quot;phase&quot; of
transformation that a program goes through in order to become a format that
chalk can understand.</p>
<h3><a class="header" href="#rust-intermediate-representation-a-hrefhttpsrust-langgithubiochalkchalk_rust_irindexhtmlchalk_rust_ira" id="rust-intermediate-representation-a-hrefhttpsrust-langgithubiochalkchalk_rust_irindexhtmlchalk_rust_ira">Rust Intermediate Representation (<a href="https://rust-lang.github.io/chalk/chalk_rust_ir/index.html">chalk_rust_ir</a>)</a></h3>
<p>After getting the AST we convert it to a more convenient intermediate
representation called <a href="https://rust-lang.github.io/chalk/chalk_rust_ir/index.html"><code>chalk_rust_ir</code></a>. This is sort of
analogous to the <a href="../hir.html">HIR</a> in Rust. The process of converting to IR is called
<em>lowering</em>.</p>
<p>The <a href="https://rust-lang.github.io/chalk/chalk_integration/program/struct.Program.html"><code>chalk::program::Program</code></a> struct contains some &quot;rust things&quot;
but indexed and accessible in a different way. For example, if you have a
type like <code>Foo&lt;Bar&gt;</code>, we would represent <code>Foo</code> as a string in the AST but in
<code>chalk::program::Program</code>, we use numeric indices (<code>ItemId</code>).</p>
<p>The <a href="https://rust-lang.github.io/chalk/chalk_rust_ir/">IR source code</a> contains the complete definition.</p>
<h3><a class="header" href="#chalk-intermediate-representation-a-hrefhttpsrust-langgithubiochalkchalk_irindexhtmlchalk_ira" id="chalk-intermediate-representation-a-hrefhttpsrust-langgithubiochalkchalk_irindexhtmlchalk_ira">Chalk Intermediate Representation (<a href="https://rust-lang.github.io/chalk/chalk_ir/index.html">chalk_ir</a>)</a></h3>
<p>Once we have Rust IR it is time to convert it to &quot;program clauses&quot;. A
<a href="https://rust-lang.github.io/chalk/chalk_ir/struct.ProgramClause.html"><code>ProgramClause</code></a> is essentially one of the following:</p>
<ul>
<li>A <a href="https://github.com/rust-lang/chalk/blob/master/GLOSSARY.md#clause">clause</a> of the form <code>consequence :- conditions</code> where <code>:-</code> is read as
&quot;if&quot; and <code>conditions = cond1 &amp;&amp; cond2 &amp;&amp; ...</code></li>
<li>A universally quantified clause of the form
<code>forall&lt;T&gt; { consequence :- conditions }</code>
<ul>
<li><code>forall&lt;T&gt; { ... }</code> is used to represent <a href="https://en.wikipedia.org/wiki/Universal_quantification">universal quantification</a>. See the
section on <a href="./lowering-to-logic.html#type-checking-generic-functions-beyond-horn-clauses">Lowering to logic</a> for more information.</li>
<li>A key thing to note about <code>forall</code> is that we don't allow you to &quot;quantify&quot;
over traits, only types and regions (lifetimes). That is, you can't make a
rule like <code>forall&lt;Trait&gt; { u32: Trait }</code> which would say &quot;<code>u32</code> implements
all traits&quot;. You can however say <code>forall&lt;T&gt; { T: Trait }</code> meaning &quot;<code>Trait</code>
is implemented by all types&quot;.</li>
<li><code>forall&lt;T&gt; { ... }</code> is represented in the code using the <a href="https://rust-lang.github.io/chalk/chalk_ir/struct.Binders.html"><code>Binders&lt;T&gt;</code>
struct</a>.</li>
</ul>
</li>
</ul>
<p><em>See also: <a href="./goals-and-clauses.html">Goals and Clauses</a></em></p>
<p>This is where we encode the rules of the trait system into logic. For
example, if we have the following Rust:</p>
<pre><code class="language-rust ignore">impl&lt;T: Clone&gt; Clone for Vec&lt;T&gt; {}
</code></pre>
<p>We generate the following program clause:</p>
<pre><code class="language-rust ignore">forall&lt;T&gt; { (Vec&lt;T&gt;: Clone) :- (T: Clone) }
</code></pre>
<p>This rule dictates that <code>Vec&lt;T&gt;: Clone</code> is only satisfied if <code>T: Clone</code> is also
satisfied (i.e. &quot;provable&quot;).</p>
<p>Similar to <a href="https://rust-lang.github.io/chalk/chalk_integration/program/struct.Program.html"><code>chalk::program::Program</code></a> which has &quot;rust-like
things&quot;, chalk_ir defines <a href="https://rust-lang.github.io/chalk/chalk_integration/program_environment/struct.ProgramEnvironment.html"><code>ProgramEnvironment</code></a> which is &quot;pure logic&quot;.
The main field in that struct is <code>program_clauses</code>, which contains the
<a href="https://rust-lang.github.io/chalk/chalk_ir/struct.ProgramClause.html"><code>ProgramClause</code></a>s generated by the rules module.</p>
<h3><a class="header" href="#rules-a-hrefhttpsrust-langgithubiochalkchalk_solveindexhtmlchalk_solvea" id="rules-a-hrefhttpsrust-langgithubiochalkchalk_solveindexhtmlchalk_solvea">Rules (<a href="https://rust-lang.github.io/chalk/chalk_solve/index.html">chalk_solve</a>)</a></h3>
<p>The <code>chalk_solve</code> crate (<a href="https://rust-lang.github.io/chalk/chalk_solve/index.html">source code</a>) defines the logic rules we
use for each item in the Rust IR. It works by iterating over every trait, impl,
etc. and emitting the rules that come from each one.</p>
<p><em>See also: <a href="./lowering-rules.html">Lowering Rules</a></em></p>
<h4><a class="header" href="#well-formedness-checks" id="well-formedness-checks">Well-formedness checks</a></h4>
<p>As part of lowering to logic, we also do some &quot;well formedness&quot; checks. See
the <a href="https://rust-lang.github.io/chalk/chalk_solve/wf/index.html"><code>chalk_solve::wf</code> source code</a> for where those are done.</p>
<p><em>See also: <a href="./wf.html">Well-formedness checking</a></em></p>
<h4><a class="header" href="#coherence" id="coherence">Coherence</a></h4>
<p>The method <code>CoherenceSolver::specialization_priorities</code> in the <code>coherence</code> module
(<a href="https://rust-lang.github.io/chalk/chalk_solve/coherence/index.html">source code</a>) checks &quot;coherence&quot;, which means that it
ensures that two impls of the same trait for the same type cannot exist.</p>
<h3><a class="header" href="#solver-a-hrefhttpsrust-langgithubiochalkchalk_solveindexhtmlchalk_solvea" id="solver-a-hrefhttpsrust-langgithubiochalkchalk_solveindexhtmlchalk_solvea">Solver (<a href="https://rust-lang.github.io/chalk/chalk_solve/index.html">chalk_solve</a>)</a></h3>
<p>Finally, when we've collected all the program clauses we care about, we want
to perform queries on it. The component that finds the answer to these
queries is called the <em>solver</em>.</p>
<p><em>See also: <a href="./slg.html">The SLG Solver</a></em></p>
<h2><a class="header" href="#crates" id="crates">Crates</a></h2>
<p>Chalk's functionality is broken up into the following crates:</p>
<ul>
<li><a href="https://rust-lang.github.io/chalk/chalk_engine"><strong>chalk_engine</strong></a>: Defines the core <a href="./slg.html">SLG solver</a>.</li>
<li><a href="https://rust-lang.github.io/chalk/chalk_rust_ir/index.html"><strong>chalk_rust_ir</strong></a>, containing the &quot;HIR-like&quot; form of the AST</li>
<li><a href="https://rust-lang.github.io/chalk/chalk_ir/index.html"><strong>chalk_ir</strong></a>: Defines chalk's internal representation of
types, lifetimes, and goals.</li>
<li><a href="https://rust-lang.github.io/chalk/chalk_solve/index.html"><strong>chalk_solve</strong></a>: Combines <code>chalk_ir</code> and <code>chalk_engine</code>,
effectively, which implements logic rules converting <code>chalk_rust_ir</code> to
<code>chalk_ir</code>
<ul>
<li>Defines the <code>coherence</code> module, which implements coherence rules</li>
<li><a href="https://rust-lang.github.io/chalk/chalk_engine/context/index.html"><code>chalk_engine::context</code></a> provides the necessary hooks.</li>
</ul>
</li>
<li><a href="https://rust-lang.github.io/chalk/chalk_parse/index.html"><strong>chalk_parse</strong></a>: Defines the raw AST and a parser.</li>
<li><a href="https://rust-lang.github.io/chalk/chalk/index.html"><strong>chalk</strong></a>: Brings everything together. Defines the following
modules:
<ul>
<li><code>chalk::lowering</code>, which converts AST to <code>chalk_rust_ir</code></li>
<li>Also includes <a href="https://github.com/rust-lang/chalk/blob/master/src/main.rs">chalki</a>, chalk's REPL.</li>
</ul>
</li>
</ul>
<p><a href="https://github.com/rust-lang/chalk">Browse source code on GitHub</a></p>
<h2><a class="header" href="#testing" id="testing">Testing</a></h2>
<p>chalk has a test framework for lowering programs to logic, checking the
lowered logic, and performing queries on it. This is how we test the
implementation of chalk itself, and the viability of the <a href="./lowering-rules.html">lowering
rules</a>.</p>
<p>The main kind of tests in chalk are <strong>goal tests</strong>. They contain a program,
which is expected to lower to logic successfully, and a set of queries
(goals) along with the expected output. Here's an
<a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L115">example</a>. Since chalk's output can be quite long, goal
tests support specifying only a prefix of the output.</p>
<p><strong>Lowering tests</strong> check the stages that occur before we can issue queries
to the solver: the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/rust_ir/lowering/test.rs">lowering to chalk_rust_ir</a>, and the
<a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/rules/wf/test.rs#L1">well-formedness checks</a> that occur after that.</p>
<h3><a class="header" href="#testing-internals" id="testing-internals">Testing internals</a></h3>
<p>Goal tests use a <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L33"><code>test!</code> macro</a> that takes chalk's Rust-like
syntax and runs it through the full pipeline described above. The macro
ultimately calls the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test.rs#L85"><code>solve_goal</code> function</a>.</p>
<p>Likewise, lowering tests use the <a href="https://github.com/rust-lang/chalk/blob/4bce000801de31bf45c02f742a5fce335c9f035f/src/test_util.rs#L21-L54"><code>lowering_success!</code> and
<code>lowering_error!</code> macros</a>.</p>
<h2><a class="header" href="#more-resources" id="more-resources">More Resources</a></h2>
<ul>
<li><a href="https://github.com/rust-lang/chalk">Chalk Source Code</a></li>
<li><a href="https://github.com/rust-lang/chalk/blob/master/GLOSSARY.md">Chalk Glossary</a></li>
</ul>
<h3><a class="header" href="#blog-posts" id="blog-posts">Blog Posts</a></h3>
<ul>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/01/26/lowering-rust-traits-to-logic/">Lowering Rust traits to logic</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/03/25/unification-in-chalk-part-1/">Unification in Chalk, part 1</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/04/23/unification-in-chalk-part-2/">Unification in Chalk, part 2</a></li>
<li><a href="https://aturon.github.io/blog/2017/04/24/negative-chalk/">Negative reasoning in Chalk</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/05/25/query-structure-in-chalk/">Query structure in chalk</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2017/09/12/tabling-handling-cyclic-queries-in-chalk/">Cyclic queries in chalk</a></li>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2018/01/31/an-on-demand-slg-solver-for-chalk/">An on-demand SLG solver for chalk</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../traits/slg.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../traits/bibliography.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../traits/slg.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../traits/bibliography.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
